<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST API</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <section>
        <a href="../19_http.html"><<назад</a>
        <h1>REST API</h1>
        <p>
          Сервер это компьютер со специальным программным обеспечением. Бекенд это программа, расположенная на сервере, способная обработать входящие HTTP-запросы и имеющая набор готовых действий на определенные запросы.

          <img src="../img/rest-api.png" alt="REST API"  width="100%">

          <ul>
              <li>API (интерфейс прикладного программирования) - набор четко определенных правил связи между различными программными компонентами. Интерфейс описывает, что можно попросить программу сделать и что получится в результате.</li>
              <li>REST (representational state transfer) - стиль бекенд-архитектуры, основанный на наборе принципов, которые описывают как сетевые ресурсы определяются и адресуются.</li>
              <li>REST API - бекенд построенный по принципу REST. Служит прослойкой между веб-приложением и базой данных. Имеет стандартный интерфейс для обращения к ресурсам. Работает как веб-сайт, мы посылаем HTTP-запрос с клиента на сервер, а в ответ, вместо HTML-страницы, получаем данные в JSON-формате.</li>
          </ul>

<h2>
    Формат запроса
</h2>

<br> <br> REST-сервис требует, чтобы клиент делал запрос на добавление, извлечение или изменение данных. Запрос может состоять из следующих частей.
<br> <br> HTTP-метод	Определяет какую операцию выполнять.
<br> <br> HTTP-заголовки	Позволяет клиенту передавать служебную информацию о запросе.
<br> <br> Путь	Путь к ресурсу. Доступные пути описываются в документации бэкенда.
<br> <br> Тело	Блок запроса содержащий данные.

<h2>
    HTTP-методы
</h2>
Выделяют несколько основных HTTP-методов для работы с REST-сервисом.

<br> <br> Method	Description
<br> <br> POST	Создать новый ресурс
<br> <br> GET	Получить набор ресурсов или один ресурс
<br> <br> PUT	Обновить существующий или создать новый ресурс
<br> <br> PATCH	Обновить существующий ресурс
<br> <br> DELETE	Удалить ресурс

<h2>
    HTTP-заголовки
</h2>

Заголовки содержат служебную информацию относящуюся к контенту запроса. Например, тип контента, который клиент может обработать в ответе от сервера (заголовок Accept) или который описывает тип ресурса, который клиент отправляет серверу или сервер отправляет клиенту (заголовок Content-Type).

<code>
    Accept: text/html <br>
Content-Type: application/json
</code>

MIME-типы - варианты типов контента. Используются для указания содержимого запроса и ответа, состоят из типа и подтипа, которые разделены косой чертой /. Например, текстовый файл, содержащий HTML, будет описан типом text/html. Если файл содержит CSS, он будет описан как text/css. Данные в формате JSON будут описаны как application/json. Если клиент ожидает text/css, а получает application/json, он не сможет распознать и обработать контент овтета.

<h2>
    Пути
</h2>

Запросы должны содержать путь к ресурсу, над которым выполняется операция. Доступные пути (эндпоинты, ресурсы) описываются в документации бэкенда.

<code>
    GET https://bookstore.com/api/orders <br>
Accept: application/json
</code>

Такой путь явно указывает ресурс, даже если вы его никогда раньше не видели, потому что он является иерархическим и описательным. Мы выполняем запрос для получения коллекции заказов.

Для того чтобы получить один элемент коллекции, его идентификатор добавляется к ресурсу. Рассмотрим запрос на чтение одного заказа с идентификатором 289.

<code>
    GET https://bookstore.com/api/orders/289 <br>
Accept: application/json
</code>

Последняя часть пути называется динамический параметр и в документации описывается как /ресурс/:параметр. Ресурс неизменен, это путь к целой коллекции, а значение параметра меняется для каждого её элемента.

<h2>
    Коды ответов
</h2>
На запрос клиента сервер отправляет ответ, который содержит код состояния, чтобы информировать клиента о результате операции. Коды делятся на группы.

<br> <br> Group	Description
<br> <br> 1XX	Несут информационное назначение
<br> <br> 2XX	Коды успешного проведения операции
<br> <br> 3XX	Описывают все, что связано с перенаправлением (redirect)
<br> <br> 4XX	Указывают на ошибки клиента
<br> <br> 5XX	Указывают на ошибки со стороны сервера
<h4>
    ИНТЕРЕСНО
Нет необходимости помнить все коды из каждой группы, достаточно знать наиболее распространенные. Остальные всегда можно посмотреть в справочнике HTTP-кодов.
</h4>

<br> <br> Code	Description
<br> <br> 200 (OK)	Стандартный ответ для успешных HTTP-запросов.
<br> <br> 201 (Created)	Стандартный ответ для HTTP-запроса, который привел к успешному созданию ресурса.
<br> <br> 400 (Bad Request)	Запрос не может быть обработан из-за неверного синтаксиса запроса или другой ошибки клиента.
<br> <br> 401 (Unauthorized)	Для доступа к ресурсу требуется авторизация.
<br> <br> 403 (Forbidden)	У клиента нет разрешения на доступ к этому ресурсу.
<br> <br> 404 (Not Found)	В настоящее время ресурс не найден. Возможно, он был удален или еще не существует.
<br> <br> 500 (Internal Server Error)	Общий ответ на непредвиденный сбой сервера, если нет более конкретной информации.

<h2>
    Запрос-Ответ
</h2>

Предположим у нас есть приложение которое позволяет просматривать, создавать, редактировать и удалять клиентов и заказы небольшого книжного магазина, бекенд которого размещен на bookstore.com/api. Используя полученные знания опишем псевдокодом процесс запрос-ответ к бекенду.

Если мы хотим получить данные о всех клиентах, GET запрос будет выглядеть так.

<code>
    GET bookstore.com/api/customers
Accept: application/json
</code>

На что сервер отправит нам такой ответ.

<code>
    Status: 200 OK <br>
Content-Type: application/json <br>
Body: JSON-данные о всех клиентах
</code>

Для получения данных одного клиента мы указываем его идентификатор, уточняя GET запрос.

<code>
    GET bookstore.com/api/customers/289 <br>
Accept: application/json
</code>

На что сервер отправит нам такой ответ.

<code>
    Status: 200 OK <br>
Content-Type: application/json <br>
Body: JSON-данные о клиенте
</code>

Для того чтобы добавить нового клиента выполняем POST запрос.

<code>
    POST bookstore.com/api/customers <br>
Content-Type: application/json <br>
Body: { "username": "Mango", "email": "mango@gmail.com" }
</code>

Сервер добавляет уникальный идентификатор и возвращает объект целиком как результат.

<code>
Status: 201 Created <br>
Content-type: application/json <br>
Body: { "id": 18674, "username": "Mango", "email": "mango@gmail.com" }
</code>
        </p>
    </section>
</body>
</html>