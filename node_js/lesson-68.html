<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пакетный менеджер npm</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <section>
        <a href="../15_node_js.html"><<назад</a>
        <h1>Пакетный менеджер npm</h1>

        <p>
            Чтобы использовать все богатство инструментов (или пакетов) Node.js нам нужна возможность устанавливать и управлять ими. Для этого создан NPM (node package manager) - пакетный менеджер Node.js. Он устанавливает нужные пакеты и предоставляет удобный интерфейс для работы с ними.
<br><br>
NPM состоит из трех основных компонентов:

<ul>
  <Li>Сайт npmjs.com - используется для поиска и ознакомления с документацией пакетов.
</Li>
  <Li>Интерфейс командной строки (CLI) - запускается из терминала и предоставляет набор команд для работы с реестром и пакетами. Позволяет создавать скрипты для запуска в терминале.
</Li>
  <Li>Реестр пакетов (registry) - большая общедоступная база данных инструментов разработки (пакетов).
</Li>
  <Li>Пакет (package) - небольшая JavaScript библиотека, решающая специфическую задачу. Пакеты пишут сами разработчики и делятся с сообществом. Такой подход упрощает жизнь, потому что не нужно изобретать колесо, все колеса уже давно лежат на полках реестра и готовы к использованию.
</Li>
</ul>

<h4>ИНТЕРЕСНО
Пакеты абстрагируют реализацию функционала, предоставляя разработчику удобный интерфейс. Это делает код чище, читабельнее и позволяет легче его поддерживать.
</h4>

<h2>Команды NPM</h2>
Сразу перечислим основные команды и будем последовательно использовать и рассматривать в деталях.
<br>

<ul>
  <li>npm init - инициализирует npm в проекте и создает файл package.json</li>
  <li>npm install - устанавливает все зависимости перечисленные в package.json</li>
  <li>npm list --depth=0 - выведет в терминале список локально установленных пакетов с номерами их версий, без зависимостей</li>
  <li>npm install [package-name] - установит пакет локально в папку node_modules</li>
  <li>npm uninstall [package-name] - удалит пакет, установленный локально и обновит package.json</li>
  <li>npm start и npm test - запустит скрипт start или test, расположенный в package.json</li>
  <li>npm run [custom-script] - запустит кастомный скрипт, расположенный в package.json</li>
  <li>npm outdated - используется для поиска обновлений, обнаружит совместимые версии программно и выведет список доступных обновлений</li>
  <li>npm update - обновит все пакеты до максимально разрешенной версии</li>
</ul>

смотри больше в Документация NPM

<h2>Инициализация проекта</h2>
Каждый проект начинается с создания файла package.json - он отслеживает зависимости, содержит служебную информацию, позволяет писать npm-скрипты и служит инструкцией при создании нового проекта на основе уже готовых настроек. Создать файл package.json можно npm-командой init, тем самым инициализировав проект в текущей папке.
<br><br>
<code>npm init</code>
<br>
Вам будет предложено ввести название проекта, версию, описание и т. д. Можно просто нажимать Enter до тех пор, пока не будет создан package.json и размещен в папке проекта. Чтобы не нажимать Enter, пропуская пустые поля, используется команда init с флагом --yes. Флаг - дополнительная настройка для команды.
<br><br>
<code>npm init --yes</code>
<br>
<h4>ИНТЕРЕСНО
У каждого флага есть есть псевдоним - его сокращённая запись. Псевдоним флага --yes это -y, поэтому комманды npm init --yes и npm init -y делают одно и тоже.
</h4>

Будет создан package.json со значениями по умолчанию. Чтобы установить эти значения, в терминале последовательно выполните следующие команды, подставив свое имя и почту.
<br>

<ul>
  <li>npm config set init.author.name "YOUR_NAME"</li>
  <li>npm config set init.author.email "YOUR_EMAIL"</li>
</ul>


<code>
  npm init
</code>
<br>
Можно редактировать файл package.json вручную или выполнить npm init ещё раз. Если открыть package.json в редакторе, он будет выглядеть примерно так. Это всего лишь метаданные о проекте.
<br>
<code>
  <br>package.json
<br>{
<br>  "name": "node-tut",
<br>  "version": "1.0.0",
<br>  "main": "index.js",
 <br> "scripts": {
 <br>   "test": "echo \"Error: no test specified\" && exit 1"
 <br> },
<br>  "author": "Alexander Repeta <mycoolemail@mail.com>",
 <br> "license": "ISC",
 <br> "keywords": [],
 <br> "description": ""
<br>}
</code>

<h2>npm-скрипты</h2>
Скрипты позволяют запускать на исполнение установленные пакеты. Используя npm-скрипты, можно создавать целые системы сборки проекта. Автоматизируем запуск index.js. Для этого в файле package.json в поле scripts добавим скрипт запуска start.
<code>
package.json
<br>{
 <br> "scripts": {
 <br>   "start": "node index.js"
<br>  }
<br>}
<br>
</code>
Теперь мы можем запустить его в терминале командой npm start.
<br>
<code>
  npm start
</code>
<br>
<h3>
  ВНИМАНИЕ
Если создать скрипт с любым другим именем, кроме start или test, он будет запускаться как npm run имя-скрипта - не забудьте run. Ознакомтесь с документацией - How npm handles the "scripts" field.
</h3>

<h2>Установка пакетов</h2>
Одна из возможностей, которые предоставляет npm - установка пакетов, которые извлекаются из реестра и распаковываются в папку node_modules в корне проекта. После того как файл package.json создан, можно добавить зависимости в проект.
<br>
Зависимостью называют npm-пакет, который используется при разработке. Это всевозможные утилиты и библиотеки. Установим библиотеку validator.js для валидации строк, например ввода пользователя в поля формы.
<br><br>
<code>npm install validator</code>
<br>
NPM загрузил validator и поместил его в node_modules - папку, в которой будут находиться все внешние зависимости.
<br>
<h3>
  ВНИМАНИЕ
Не добавляйте папку node_modules в систему контроля версий, у всех разработчиков она будет своя. Если вы используете Git, не забывайте добавить папку node_modules в файл .gitignore.
</h3>
<br>
Обратите внимание на созданный файл package-lock.json - это журнал снимков дерева зависимостей проекта. Он гарантирует, что команда разработчиков использует одни и те же версии зависимостей. NPM автоматически обновляет его при добавлении, удалении и обновлении пакетов.
<br><br>
В package.json появилась новая зависимость в поле dependencies. Это означает, что validator версии 11.1.0 был установлен как зависимость и готов к работе. Пакеты постоянно обновляются, ваша версия может отличаться.
<br><br>
<code>
  <br> package.json
<br> {
<br>   "dependencies": {
<br>     "validator": "^11.1.0"
<br>   }
<br> }
</code>
<br><br>
Для того чтобы получить интерфейс пакета в Node.js-коде, необходимо вызвать функцию require("имя-модуля"), аргументом передав ей имя модуля без определения пути - это называется абсолютный импорт. Путь не нужен, так как по умолчанию поиск модуля будет происходить в папке node_modules. Результатом своего выполнения функция вернет интерфейс модуля - объект с методами или просто функцию, зависит от пакета.
<br>
<br>
<code>
<br>  const validator = require("validator");
<br>
<br>const validateEmail = email => {
<br>  return validator.isEmail(email);
<br>};
<br>
<br>console.log(
<br>  "Is mango@mail.com a valid email?: ",
<br>  validateEmail("mango@mail.com")
<br>);
<br>)
<br>)console.log(
<br>)  "Is Mangozedog.com a valid email?: ",
<br>)  validateEmail("Mangozedog.com")
<br>);
</code>

<br>
Выполнив в терминале npm start получим.

<br>
<br>Is mango@mail.com a valid email?: true
<br>Is Mangozedog.com a valid email?: false
<br>

<h2>Удаление пакетов</h2>

Предположим, что установленная в предыдущем примере версия validator вызывает проблемы с совместимостью. Мы можем удалить этот пакет и поставить более старую версию.
<br><br>

<code>npm uninstall validator</code>

<h2>Установка определенной версии пакета</h2>
Теперь установим нужную версию validator. В команде установки номер версии указывается после символа @.
<br><br>
<code>npm install validator@1.0.0</code>
<br>
<h4>ИНТЕРЕСНО
Установка пакетов определенный версии используется в коммерческих проектах для того, чтобы гарантировать работу кодовой базы и возможность долгосрочной поддержки. Вы можете устанавливать самые последние версии.
</h4>
<h2>Типы зависимостей</h2>
Представьте торт, для его приготовления шефу нужны продукты, именно они войдут в состав торта. Но для приготовления понадобятся и инструменты вроде мисок, ложек, лопаток и т. п. А еще на кухне есть столы и печи, холодильники и т. д. - то, что используется для приготовления любого блюда, общие инструменты которые есть на кухне.
<br><br>
То же самое и с зависимостями проекта - некоторые будут использованы в результирующем продукте, другие необходимы только на стадии разработки, а есть такие, что необходимо использовать вне зависимости от проекта.
<br>
Именно для этого у команд npm install и npm uninstall есть три флага.
<br>

<ul>
  <li>--save - указывает, что добавляется зависимость, которая войдет в финальный продукт. Пакет будет установлен локально, в папку node_modules и будет добавлена запись в поле dependencies в package.json.
</li>
  <li>--save-dev - указывает, что добавляется зависимость разработки. Пакет будет установлен локально, в папку node_modules, и будет добавлена запись в поле devDependencies в package.json.
</li>
  <li>--global - указывает, что добавляется глобальная зависимость, то есть инструмент, который доступен для любого проекта. Пакет будет установлен глобально (в систему).
</li>
</ul>

<h4>ИНТЕРЕСНО
Если не указывать флаг, по умолчанию будет использован --save.
</h4>
<br>
<br>При удалении пакета необходимо указывать правильный флаг, такой же как при установке.
<br>Не устанавливайте пакеты глобально если вы работаете на проекте с другими разработчиками.

<h2>Управление версиями пакетов</h2>

Пакеты имеют связанный с ними номер версии. Номера версий соответствуют стандарту SemVer.
<br>

<ul>
  <li>npm outdated - используется для поиска обновлений, обнаружит совместимые версии программно.</li>
  <li>npm update - обновит все пакеты до максимально разрешенной версии.</li>
  <li>npm update [имя-пакета] - обновит указанный пакет.</li>
</ul>

<h4>ИНТЕРЕСНО
Если вы не доверяете машинам или хотите какую-то определённую версию пакета, можно открыть package.json и вручную поменять версии пакетов, после чего выполнить npm install.
</h4>

<h2>Управление кэшем</h2>

После установки пакета npm сохраняет его копию в кэше, поэтому при следующей его установке вам не нужно опять скачивать его из интернета. Кэш хранится в папке .npm вашего домашнего каталога.
<br>
Эта папка со временем засоряется старыми пакетами и иногда ее полезно очищать, не слишком часто (пару раз в год), кеширование полезно, так как сокращает время установки уже использованных пакетов.
<br>
<code>npm cache clean

</code>
        </p>
    </section>
</body>
</html>